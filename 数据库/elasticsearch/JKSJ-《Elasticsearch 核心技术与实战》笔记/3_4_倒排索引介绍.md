# 什么是倒排索引

## 概述

- 倒排索引 : 单词到文档id的关联

  - 对应一本图书中的 索引页

  -  (即 : 查询入口是单词 , 查询特定单词 通过 倒排索引 查询到对应包含该单词的文档记录)

    ![image-20220623004750553](http://assets.studymachine.cn/img/202206230047671.png)

- 正排索引 :  文档id 到文档内容和单词的关联

  - (即 : 查询入口是)
  - 对应一本图书中的目录页



## 类比

关于 **正排索引** 与 **倒排索引**的类比 , 如下所示 : 

![image-20220623005431340](http://assets.studymachine.cn/img/202206230054423.png)







## 倒排索引的核心组成

### 单词词典 (Term Dictionary)

- 记录所有文档的单词 , 记录**单词** --> **倒排索引列表**的关联关系 .
  - 单词词典一般比较大 , 可以通过B+树 或者 哈希拉链法 实现, 以满足高性能的插入和查询. 



### 倒排列表 (Posting List) 

- 记录了单词对应的文档结合, 由倒排索引项组成 . (例如上方图片右侧的列表)
  - 索引项的内容 : 
    - 文档id
    - 词频 TF (Term Frequency)  : 单词在文档中出现的次数 , 用于相关性打分
    - 位置 (Position)  - 单词在文档的位置 (**也就是单词在文档中属于第几个单词**). 用于词句搜索 (Phase Query)
    - 偏移 (Offset) - 记录单词的开始和结束位置 . 实现高亮显示. 



### 示例

- 单词 `Elasticsearch` 的倒排索引

![image-20220624004155732](http://assets.studymachine.cn/img/202206240041821.png)

## 补充

- es 的 json 文档中每个字段默认都有自己的倒排索引 .
- 可以指定某些字段不做索引 
  - 优点 : 节省空间
  - 缺点 : 字段无法被搜索到.